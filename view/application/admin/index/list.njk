{% extends 'layout/master.njk' %}

{% block content %}
<style>
.location-cell{position:relative;display:inline-flex;align-items:center;cursor:default}
.location-name{display:inline-flex;align-items:center;gap:4px}
.location-tooltip-popup{display:none;position:absolute;bottom:calc(100% + 8px);left:0;background:#fff;border-radius:20px;box-shadow:0 1px 6px rgba(0,0,0,.18);padding:6px 14px;white-space:nowrap;z-index:1050;align-items:center;gap:6px}
.location-cell:hover .location-tooltip-popup{display:inline-flex}
.location-crumb{display:inline-flex;align-items:center;gap:4px;font-size:.8rem;color:#3c4043;font-weight:500}
.location-chevron{display:inline-flex;align-items:center}
</style>
<div id="app-container">
  <!-- 1. Primary Sidebar (Icon Rail) -->
  <nav id="primary-sidebar">
    <div class="primary-nav-items">
      <!-- Home -->
      <a href="{{ url('adminIndexList', { id: rootFolderId }, { query: { view: 'my-drive', layout: layoutMode } }) }}" 
         class="primary-nav-item {% if currentFolderId == rootFolderId and viewMode != 'starred' %}active{% endif %}"
         data-tooltip="Home">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
      </a>

      <!-- My Drive (Toggles Secondary Panel) -->
      <div class="primary-nav-item {% if viewMode == 'my-drive' and currentFolderId != rootFolderId %}active{% endif %}" 
           id="btn-my-drive"
           data-tooltip="My Drive">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
        </svg>
      </div>

      <!-- Shared with me -->
      <a href="{{ url('adminIndexList', null, { query: { id: currentFolderId, view: 'shared-with-me', layout: layoutMode} }) }}" 
         class="primary-nav-item {% if viewMode == 'shared-with-me' %}active{% endif %}"
         data-tooltip="Shared with me">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
      </a>

      <!-- Recent -->
      <a href="{{ url('adminIndexList', null, { query: { id: currentFolderId, view: 'recent', layout: layoutMode} }) }}"
         class="primary-nav-item {% if viewMode == 'recent' %}active{% endif %}"
         data-tooltip="Recent">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
      </a>

      <!-- Starred -->
      <a href="{{ url('adminIndexList', null, { query: { id: currentFolderId, view: 'starred', layout: layoutMode} }) }}" 
         class="primary-nav-item {% if viewMode == 'starred' %}active{% endif %}"
         data-tooltip="Starred">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
        </svg>
      </a>

      <!-- Trash -->
      <a href="{{ url('adminIndexList', null, { query: { view: 'trash', layout: layoutMode } }) }}"
         class="primary-nav-item {% if viewMode == 'trash' %}active{% endif %}"
         data-tooltip="Trash">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="3 6 5 6 21 6"></polyline>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        </svg>
      </a>
    </div>

    <div class="primary-nav-bottom">
       <!-- Settings -->
       <a href="#" class="primary-nav-item" data-tooltip="Settings">
         <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
           <circle cx="12" cy="12" r="3"></circle>
           <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
         </svg>
       </a>
       
       <!-- User Avatar Placeholder -->
       <div class="primary-nav-item profile-item">
         <div class="user-avatar">M</div>
       </div>
    </div>
  </nav>

  <!-- 2. Secondary Sidebar (Expandable Panel) -->
  <aside id="secondary-sidebar" class="sidebar-panel">
      <div class="panel-header">
        <h5 class="panel-title">My Drive</h5>
        <!-- Optional: Close button or actions -->
      </div>
      
      <!-- New Button Area (Static, No Overflow) -->
      <div class="panel-actions">
          {{ newButton(currentFolderId) | safe }}
      </div>
      
      <div class="panel-content">


         <!-- Folder Tree -->
         <div class="folder-tree-container">
            <ul class="nav flex-column folder-tree-root">
               {% if folderTree and folderTree.length > 0 %}
                {% set treeActiveId = currentFolderId %}
                {{ renderFolderTree(folderTree, 0, treeActiveId, viewMode, layoutMode) | safe }}
              {% else %}
                <li class="pl-3 text-muted small">No folders found</li>
              {% endif %}
            </ul>
         </div>
      </div>
      
      <!-- Resize Handle -->
      <div class="resize-handle"></div>
  </aside>

  <!-- 3. Main Content -->
  <main id="main-content" style="padding-left: 16px; padding-right: 016px;">
      <!-- Search Bar Area -->
      <div class="d-flex justify-content-center align-items-center py-3 mb-3 border-bottom search-container">
         <!-- Mobile Toggle -->
         <button id="mobile-sidebar-toggle" class="btn btn-link text-muted d-md-none mr-3">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
               <line x1="3" y1="12" x2="21" y2="12"></line>
               <line x1="3" y1="6" x2="21" y2="6"></line>
               <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
         </button>

         <div class="input-group search-bar">
          <div class="input-group-prepend">
            <span class="input-group-text bg-transparent border-0">
               <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </span>
          </div>
          <input type="text" id="search-input" class="form-control bg-transparent border-0" placeholder="Search in Drive" value="{{ searchQuery }}">
          <div class="input-group-append">
            <span class="input-group-text bg-transparent border-0">
               <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="4" y1="21" x2="4" y2="14"></line>
                <line x1="4" y1="10" x2="4" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12" y2="3"></line>
                <line x1="20" y1="21" x2="20" y2="16"></line>
                <line x1="20" y1="12" x2="20" y2="3"></line>
                <line x1="1" y1="14" x2="7" y2="14"></line>
                <line x1="9" y1="8" x2="15" y2="8"></line>
                <line x1="17" y1="16" x2="23" y2="16"></line>
              </svg>
            </span>
          </div>
        </div>
      </div>

      <!-- Header with Toggle -->
      <div class="d-flex justify-content-between align-items-center mb-3">
         <h2 class="section-header mb-0">
          {% if viewMode == 'search' %}
            Search results for "{{ searchQuery }}"
          {% elif viewMode == 'shared-with-me' %}
            Shared with me
          {% elif viewMode == 'recent' %}
            Recent
          {% elif viewMode == 'starred' %}
            Starred
          {% elif viewMode == 'trash' %}
            Trash
          {% else %}
            My Drive
          {% endif %}
         </h2>
         <div class="btn-group" role="group" aria-label="Layout View">
            {% set listUrl = url('adminIndexList', { id: currentFolderId }, { query: { view: viewMode, layout: 'list' } }) %}
            {% set gridUrl = url('adminIndexList', { id: currentFolderId }, { query: { view: viewMode, layout: 'grid' } }) %}

            <a href="{{ listUrl }}" class="btn btn-sm btn-outline-secondary {% if layoutMode == 'list' %}active{% endif %}">

              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="8" y1="6" x2="21" y2="6"></line>
                <line x1="8" y1="12" x2="21" y2="12"></line>
                <line x1="8" y1="18" x2="21" y2="18"></line>
                <line x1="3" y1="6" x2="3.01" y2="6"></line>
                <line x1="3" y1="12" x2="3.01" y2="12"></line>
                <line x1="3" y1="18" x2="3.01" y2="18"></line>
              </svg>
            </a>
            <a href="{{ gridUrl }}" class="btn btn-sm btn-outline-secondary {% if layoutMode == 'grid' %}active{% endif %}">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
              </svg>
            </a>
         </div>
      </div>

      {# Unified view: combined folders + files in a single list/grid with pagination #}
      {% if (subFolders and subFolders.length > 0) or (filesList and filesList.length > 0) %}
        {% if layoutMode == 'list' %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th scope="col" style="width: 40%;">Name</th>
                  <th scope="col">Owner</th>
                  {% if viewMode == 'search' %}
                    <th scope="col">Location</th>
                  {% endif %}
                  <th scope="col">Last Modified</th>
                  <th scope="col" class="text-right">File Size</th>
                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody>
                {% if subFolders and subFolders.length > 0 %}
                  {{ folderList(subFolders, viewMode, layoutMode, starredFolderIds) | safe }}
                {% endif %}
                {% if filesList and filesList.length > 0 %}
                  {{ fileList(filesList, starredFileIds, viewMode, layoutMode) | safe }}
                {% endif %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="row mb-4">
            {% if subFolders and subFolders.length > 0 %}
              {{ folderGrid(subFolders, viewMode, layoutMode, starredFolderIds, false) | safe }}
            {% endif %}
            {% if filesList and filesList.length > 0 %}
              {{ fileGrid(filesList, starredFileIds, viewMode, layoutMode, false) | safe }}
            {% endif %}
          </div>
        {% endif %}
      {% endif %}

      {% if pagination %}
        {{ paginationWidget(pagination, viewMode, currentFolderId, searchQuery or '', layoutMode) | safe }}
      {% endif %}

      {% if (not subFolders or subFolders.length == 0) and (not filesList or filesList.length == 0) %}
        <div class="text-center mt-5">
            <div class="mb-3">
                 <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#e0e0e0" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                 </svg>
            </div>
            <p class="text-muted">{% if viewMode == 'search' %}No results found for "{{ searchQuery }}"{% elif viewMode == 'trash' %}Trash is empty{% else %}This folder is empty{% endif %}</p>
        </div>
      {% endif %}

    </main>
</div>

  <!-- Rename Folder Modal -->
  <div class="modal fade" id="renameFolderModal" tabindex="-1" role="dialog" aria-labelledby="renameFolderModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header border-bottom-0">
          <h5 class="modal-title" id="renameFolderModalLabel">Rename</h5>
        </div>
        <div class="modal-body">
          <form id="renameFolderForm" onsubmit="return false;">
            <input type="hidden" id="renameFolderId" name="folder_id">
            <div class="form-group">
              <input type="text" class="form-control" id="renameFolderName" name="name" placeholder="Folder name" required>
            </div>
          </form>
        </div>
        <div class="modal-footer border-top-0">
          <button type="button" class="btn btn-text text-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary px-4" id="btnRenameFolderConfirm">OK</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Rename File Modal -->
  <div class="modal fade" id="renameFileModal" tabindex="-1" role="dialog" aria-labelledby="renameFileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header border-bottom-0">
          <h5 class="modal-title" id="renameFileModalLabel">Rename File</h5>
        </div>
        <div class="modal-body">
          <form id="renameFileForm">
            <input type="hidden" id="renameFileId" name="file_id">
            <div class="form-group">
              <input type="text" class="form-control" id="renameFileName" name="name" placeholder="File name" required>
            </div>
          </form>
        </div>
        <div class="modal-footer border-top-0">
          <button type="button" class="btn btn-text text-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary px-4" id="btnRenameFileConfirm">OK</button>
        </div>
      </div>
    </div>
  </div>

<!-- Delete Confirmation Modal (kept as is) -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteConfirmationModalLabel">Confirm Deletion</h5>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to move this item to the trash?</p>
        <p class="text-danger">To confirm, type "<strong>Delete</strong>" in the box below.</p>
        <input type="text" id="deleteConfirmInput" class="form-control" placeholder="Type 'Delete' to confirm">
        <input type="hidden" id="deleteTargetUrl">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" id="confirmDeleteBtn" class="btn btn-danger" disabled>Delete</button>
      </div>
    </div>
  </div>
</div>
<!-- Share Modal -->
<!-- Share Modal -->
<div class="modal fade" id="shareModal" tabindex="-1" role="dialog" aria-labelledby="shareModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered share-modal-dialog" role="document">
    <div class="modal-content share-modal-content">

      <!-- Header -->
      <div class="modal-header share-modal-header">
        <h5 class="modal-title" id="shareModalLabel">Share</h5>
        <div class="share-header-actions">
            <button class="btn btn-icon" data-toggle="tooltip" title="Help">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#5f6368"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>
            </button>
            <button class="btn btn-icon" data-toggle="tooltip" title="Settings">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#5f6368"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
            </button>
        </div>
      </div>

      <div class="modal-body share-modal-body">
        <input type="hidden" id="shareFileId">

        <!-- Add People Input -->
        <div class="share-input-wrapper mb-4">
            <div class="share-input-box">
                <input type="email" class="form-control share-input" id="shareEmailInput" placeholder="Add people, groups, spaces, and calendar events">
            </div>
        </div>

        <!-- People with Access List -->
        <div class="share-section mb-3">
            <h6 class="share-section-title">People with access</h6>
            <div class="share-access-list" id="shareAccessList">
                <div class="text-center text-muted small py-2">Loading...</div>
            </div>
        </div>

        <!-- General Access -->
        <div class="share-general-access-section">
            <h6 class="share-section-title">General access</h6>
            
             <div class="general-access-row">
                <div class="general-access-main">
                    <div class="access-icon-bg" id="generalAccessIcon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="#5f6368"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>
                    </div>
                    <div class="access-info-col">
                        <div class="select-wrapper">
                             <select class="custom-select access-select-main" id="generalAccessSelect">
                                <option value="restricted">Restricted</option>
                                <option value="public">Anyone with the link</option>
                            </select>
                        </div>
                        <div id="generalAccessDesc" class="access-desc">Only people with access can open with the link</div>
                    </div>
                </div>
                
                <div class="general-access-role">
                    <select class="custom-select access-role-select" id="publicLinkRoleSelect" style="display: none;">
                        <option value="viewer">Viewer</option>
                        <option value="editor">Editor</option>
                    </select>
                </div>
             </div>

             <!-- Info banner for public link -->
             <div class="access-info-banner" id="publicLinkInfoBanner" style="display: none;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#1a73e8" class="info-icon"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                <span class="info-text" id="publicLinkInfoText">Viewers of this file can see comments and suggestions</span>
             </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="modal-footer share-modal-footer">
        <button type="button" class="btn btn-copy-link rounded-pill" id="btnCopyLink">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="mr-2"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
            Copy link
        </button>
        <button type="button" class="btn btn-primary rounded-pill px-4" data-dismiss="modal" id="btnShareDone">Done</button>
      </div>
    </div>
  </div>
</div>


  <!-- Move File Modal -->
  <div class="modal fade" id="moveFileModal" tabindex="-1" role="dialog" aria-labelledby="moveFileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <form id="moveFileForm" action="/admin/file/move" method="POST">
          <div class="modal-header border-bottom-0">
            <h5 class="modal-title" id="moveFileModalLabel">Move File</h5>

          </div>
          <div class="modal-body">
            <input type="hidden" id="moveFileId" name="file_id">
            <div class="form-group">
              <label for="moveDestFolder">Select Destination Folder</label>
              <select class="form-control" id="moveDestFolder" name="target_folder_id" required style="text-align: left;">
                 <option value="">Loading...</option>
              </select>
            </div>
            <div class="text-right">
              <small class="text-muted">Or <a href="#" onclick="$('#moveDestFolder').val(''); return false;">Move to Root (My Drive)</a></small>
            </div>
          </div>
          <div class="modal-footer border-top-0">
            <button type="button" class="btn btn-text text-secondary" data-dismiss="modal" id="btnMoveFileCancel">Cancel</button>
            <button type="submit" class="btn btn-primary px-4">Move</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Move Folder Modal -->
  <div class="modal fade" id="moveFolderModal" tabindex="-1" role="dialog" aria-labelledby="moveFolderModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <form id="moveFolderForm" action="/admin/folder/move" method="POST">
          <div class="modal-header border-bottom-0">
            <h5 class="modal-title" id="moveFolderModalLabel">Move Folder</h5>
          </div>
          <div class="modal-body">
            <input type="hidden" id="moveFolderId" name="folder_id">
            <div class="form-group">
              <label for="moveFolderDest">Select Destination Folder</label>
              <select class="form-control" id="moveFolderDest" name="target_folder_id" required style="text-align: left;">
                <option value="">Loading...</option>
              </select>
            </div>
          </div>
          <div class="modal-footer border-top-0">
            <button type="button" class="btn btn-text text-secondary" data-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary px-4">Move</button>
          </div>
        </form>
      </div>
    </div>
  </div>

<script>
(function() {
  var searchInput = document.getElementById('search-input');
  if (!searchInput) return;

  searchInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      var q = searchInput.value.trim();
      if (!q) {
        window.location.href = '/?view=my-drive&layout={{ layoutMode }}';
        return;
      }
      window.location.href = '/?view=search&q=' + encodeURIComponent(q) + '&layout={{ layoutMode }}';
    }
  });
})();
</script>

{% endblock %}
